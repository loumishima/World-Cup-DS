lic_meso <- licitacao_vitorias %>%
group_by(mesorregiao) %>%
summarise_at(c("valorhomologado","valorproposta","valorcontratado", "participacao", "% vitoria" ), funs("Valores nao-nulos" = length(.[!is.na(.)]),
"Media" = mean(., na.rm = TRUE),
"Mediana"= median(., na.rm = TRUE),
"Desvio padrao" = sd(., na.rm = TRUE))) %>%
gather(estatistica, valor, -mesorregiao) %>%
separate(estatistica, c("variavel","est"), sep = "_") %>%
spread(est, valor) %>% mutate_if(is.numeric,funs(round(.,2)))
lic_meso
# Quartis <- licitacao_vitorias %>% summarise_at(c("valorhomologado","valorproposta","valorcontratado", "participacao", "% vitoria" ), funs(quantile(., probs = seq(0,1,0.25), na.rm = T, names = T)))
knitr::opts_chunk$set(echo = TRUE)
library('ggplot2')
view <- ggplot(licitacao_vitorias, aes(x = modalidade), alpha = 0.5 )
view + geom_bar(fill = I("orange")) +
labs(
title = "Modalidade vs QTDE", x = "Modalidade", y = "Quantidade de Licitações"
) +
theme_bw() +
theme(plot.title = element_text(hjust = 0.5)) + geom_text(stat = 'count',aes(label = ..count..) , hjust = -0.3, size = 3 ) +  coord_flip()
view <- ggplot(licitacao_vitorias, aes(x = tipoobjeto), alpha = 0.5)
view + geom_bar(fill = I('Orange')) +
labs(
title = "Tipo de Objeto vs QTDE", x = "Tipo de objeto", y = "Quantidade de Licitações"
) +
theme_bw() +
theme( plot.title = element_text(hjust = 0.5)) + geom_text(stat = 'count',aes(label = ..count..) , vjust = -0.3)
view <- ggplot(licitacao_vitorias, aes(x = mesorregiao), alpha = 0.5)
view + geom_bar(fill = I('Orange')) +
labs(
title = " Mesorregiao vs QTDE ", x = "Mesorregiao", y = "Quantidade de Licitações"
) +
theme_bw() +
theme( plot.title = element_text(hjust = 0.5)) + geom_text(stat = 'count',aes(label = ..count..) , vjust = -0.3)
view <- ggplot(licitacao_vitorias, aes(x = as.Date(datahomologacao, format("%Y"))), alpha = 0.5)
view + geom_bar(aes(fill = modalidade)) +
labs(
title = "Tempo vs QTDE ", x = "Tempo", y = "Quantidade de Licitações"
) +
theme_bw() +
theme( plot.title = element_text(hjust = 0.5)) + geom_text(stat = 'count',aes(label = ..count..) , vjust = -0.3)
consulta <- licitacao_vitorias %>% filter(situacao == "Vencedora" & nchar(valorproposta) < 10 & valorproposta <  valorhomologado & valorproposta > 200 )
view <- ggplot(consulta, aes(x = modalidade, y = valorproposta, colour = modalidade))
view + geom_boxplot(outlier.shape = NULL) + scale_y_continuous(limits = quantile(licitacao_vitorias$valorproposta, c(0.1,0.9))) + theme_bw() +theme(axis.text.x = element_blank())
consulta_m <-consulta %>%  group_by(modalidade) %>%
summarise(media = mean(valorproposta, na.rm = T), mediana = median(valorproposta,na.rm = T), dp = sd(valorproposta,na.rm = T), max(valorproposta,na.rm = T), min(valorproposta,na.rm = T))
view <- ggplot(consulta, aes(x = tipoobjeto, y = valorproposta, colour = tipoobjeto))
view + geom_boxplot() + scale_y_continuous(limits = quantile(licitacao_vitorias$valorproposta, c(0.1,0.9)))
consulta_c <- consulta %>% group_by(tipoobjeto) %>% summarise(mediana = median(valorproposta), cont = n())
view2 <- ggplot(consulta_c, aes(x = tipoobjeto, y= mediana, fill = tipoobjeto))
view2 + geom_col() + theme( plot.title = element_text(hjust = 0.5)) + geom_text(label = consulta_c$mediana , vjust = -0.3) + theme(axis.text.x = element_blank())
view <- ggplot(consulta, aes(x= mesorregiao, y= valorproposta, colour = mesorregiao))
view + geom_boxplot()
view + geom_boxplot() + scale_y_continuous(limits = quantile(licitacao_vitorias$valorproposta, c(0.1,0.9)))
view <- ggplot(consulta, aes(x = as.Date(datahomologacao, format("%Y")), y = valorproposta), alpha = 0.5)
view + geom_col(aes(colour = mesorregiao, fill = mesorregiao))
view + geom_col(aes(colour = modalidade, fill = modalidade))
view + geom_col(aes(colour = tipoobjeto, fill = tipoobjeto))
rm(estat, lic_meso, lic_mun, consulta, consulta_c, consulta_m)
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(echo = TRUE)
# 1. Bibliotecas ----
library("stringr")
library("tidyverse")
library("data.table")
library("ggplot2")
# 1.2 Funcoes
#Casa
setwd('C:/Users/LuizH/Documents/TCC/TCC')
#
# input.dir <- 'C:/Users/LuizH/Documents/TCC/TCC'
# output.dir <- 'C:/Users/LuizH/Documents/TCC/resultados'
#TCE
#setwd('C:/Users/lrodrigues/Documents/TCE - Luiz Henrique')
#input.dir <- 'C:/Users/lrodrigues/Documents/TCE - Luiz Henrique/'
#output.dir <- 'C:/Users/lrodrigues/Documents/TCE - Luiz Henrique/resultados'
licitacao<-fread("raw.csv", encoding ="UTF-8")
licitacao %>% str()
licitacao_ia<-licitacao %>%
mutate(tipo_pessoa = case_when(
is.na(cpf) ~ 2, !is.na(cpf) ~ 1 )) %>%
mutate_if(is.double, as.numeric)
licitacao_unificada <- licitacao_ia %>%
mutate(cpf.cnpj = case_when(is.na(cpf) ~cnpj, !is.na(cpf) ~cpf )) %>%
select(-(nomepj:cpf))
licitacao_unificada$cpf.cnpj <- as.character(licitacao_unificada$cpf.cnpj)
licitacao_unificada %>% select(cpf.cnpj,tipo_pessoa) %>% head(.,15)
licitacao_unificada <- licitacao_unificada %>% filter(!is.na(valorproposta))
licitacao_count <- licitacao_unificada %>%
group_by(cpf.cnpj) %>% mutate("participacao" = n()) %>% ungroup()
licitacao_count %>% select(cpf.cnpj,participacao) %>% head(.,15)
licitacao_vitorias <- licitacao_count %>%
mutate(situacaodaproposta = case_when(situacaodaproposta == 2 ~ 0, situacaodaproposta == 1 ~ 1)) %>%
group_by(cpf.cnpj)  %>%
mutate("% vitoria" = (sum(situacaodaproposta)/participacao) * 100 ) %>%
ungroup(cpf.cnpj) %>%
mutate(governoestadual = case_when(governoestadual == "true" ~ 1.0, governoestadual == "false" ~ 0.0)) %>%
mutate(id_meso =ifelse(is.na(id_meso), 0, id_meso)) %>%
mutate(id_mic =ifelse(is.na(id_mic), 0, id_mic)) %>%
mutate(id_mun =ifelse(is.na(id_mun), 0, id_mun)) %>%
mutate(mesorregiao = ifelse(mesorregiao == "","Paraiba", mesorregiao)) %>%
mutate(microrregiao = ifelse(microrregiao == "","Paraiba",microrregiao)) %>%
mutate(municipio = ifelse(municipio == "","Paraiba",municipio))
licitacao_vitorias %>% filter(governoestadual == 1) %>% select(situacaodaproposta, "% vitoria", governoestadual, mesorregiao, microrregiao, municipio) %>% head(.,15)
rm(licitacao,licitacao_count,licitacao_ia,licitacao_unificada)
#Parte Numerica
licitacao_num <- licitacao_vitorias %>%
select(idlicitacao, id_mod, situacaodaproposta, valorproposta, valorcontratado, valorhomologado,governoestadual,id_obj,id_jur,id_meso, id_mic, id_mun, tipo_pessoa, cpf.cnpj, participacao, '% vitoria') %>%
filter(valorproposta > 200 & valorhomologado > 200 & !is.na(valorproposta)& !is.na(valorhomologado) & nchar(valorproposta) < 13 )
licitacao_num %>% head(.,15)
#REALIZAR SELECAO ALEATORIA DOS ID'S E ENTÃO FILTRAR NOS CAMPOS!!!!! (RICHARD GOD)
licitacao_info <- licitacao_vitorias %>%
select(datahomologacao, objeto, numerolicitacao, modalidade, situacao, valorhomologado, valorproposta, valorcontratado, governoestadual, tipoobjeto,jurisdicionado,mesorregiao, microrregiao, municipio, protocolo_licitacao, cpf.cnpj, participacao, '% vitoria')
#Aqui é ideal para o sistema de Classificação
licitacao_sampled <- licitacao_num %>%
group_by(idlicitacao) %>%
add_tally(situacaodaproposta == 0) %>%
filter(n > 0) %>%
ungroup()
#remove licitações que só contenham vencedores
licitacao_w <- licitacao_sampled %>%  count(situacaodaproposta)
#contagem de vitórias e derrotas - Aproximadamente 50/50 de derrotas e vitorias
rm(licitacao_w)
estat <- licitacao_vitorias %>% select("valorhomologado","valorproposta","valorcontratado", "participacao", "% vitoria" ) %>%   summarise_all( funs(length(.[!is.na(.)]),
mean(., na.rm = TRUE),
median(., na.rm = TRUE),
sd(., na.rm = TRUE),
min(., na.rm = TRUE),
max(., na.rm = TRUE))) %>%
gather(estatistica, valor) %>%
separate(estatistica, c("variavel","est"), sep = "_") %>%
spread(est, valor)
estat
lic_mun <- licitacao_vitorias %>%
group_by(municipio) %>%
summarise_at(c("valorhomologado","valorproposta","valorcontratado", "participacao", "% vitoria" ), funs("Valores nao-nulos" = length(.[!is.na(.)]),
"Media" = mean(., na.rm = TRUE),
"Mediana"= median(., na.rm = TRUE),
"Desvio padrao" = sd(., na.rm = TRUE))) %>%
gather(estatistica, valor, -municipio) %>%
separate(estatistica, c("variavel","est"), sep = "_") %>%
spread(est, valor) %>% mutate_if(is.numeric,funs(round(.,2)))
lic_mun
lic_meso <- licitacao_vitorias %>%
group_by(mesorregiao) %>%
summarise_at(c("valorhomologado","valorproposta","valorcontratado", "participacao", "% vitoria" ), funs("Valores nao-nulos" = length(.[!is.na(.)]),
"Media" = mean(., na.rm = TRUE),
"Mediana"= median(., na.rm = TRUE),
"Desvio padrao" = sd(., na.rm = TRUE))) %>%
gather(estatistica, valor, -mesorregiao) %>%
separate(estatistica, c("variavel","est"), sep = "_") %>%
spread(est, valor) %>% mutate_if(is.numeric,funs(round(.,2)))
lic_meso
# Quartis <- licitacao_vitorias %>% summarise_at(c("valorhomologado","valorproposta","valorcontratado", "participacao", "% vitoria" ), funs(quantile(., probs = seq(0,1,0.25), na.rm = T, names = T)))
library('ggplot2')
view <- ggplot(licitacao_vitorias, aes(x = modalidade), alpha = 0.5 )
view + geom_bar(fill = I("orange")) +
labs(
title = "Modalidade vs QTDE", x = "Modalidade", y = "Quantidade de Licitações"
) +
theme_bw() +
theme(plot.title = element_text(hjust = 0.5)) + geom_text(stat = 'count',aes(label = ..count..) , hjust = -0.3, size = 3 ) +  coord_flip()
view <- ggplot(licitacao_vitorias, aes(x = tipoobjeto), alpha = 0.5)
view + geom_bar(fill = I('Orange')) +
labs(
title = "Tipo de Objeto vs QTDE", x = "Tipo de objeto", y = "Quantidade de Licitações"
) +
theme_bw() +
theme( plot.title = element_text(hjust = 0.5)) + geom_text(stat = 'count',aes(label = ..count..) , vjust = -0.3)
view <- ggplot(licitacao_vitorias, aes(x = mesorregiao), alpha = 0.5)
view + geom_bar(fill = I('Orange')) +
labs(
title = " Mesorregiao vs QTDE ", x = "Mesorregiao", y = "Quantidade de Licitações"
) +
theme_bw() +
theme( plot.title = element_text(hjust = 0.5)) + geom_text(stat = 'count',aes(label = ..count..) , vjust = -0.3)
view <- ggplot(licitacao_vitorias, aes(x = as.Date(datahomologacao, format("%Y"))), alpha = 0.5)
view + geom_bar(aes(fill = modalidade)) +
labs(
title = "Tempo vs QTDE ", x = "Tempo", y = "Quantidade de Licitações"
) +
theme_bw() +
theme( plot.title = element_text(hjust = 0.5)) + geom_text(stat = 'count',aes(label = ..count..) , vjust = -0.3)
consulta <- licitacao_vitorias %>% filter(situacao == "Vencedora" & nchar(valorproposta) < 10 & valorproposta <  valorhomologado & valorproposta > 200 )
view <- ggplot(consulta, aes(x = modalidade, y = valorproposta, colour = modalidade))
view + geom_boxplot(outlier.shape = NULL) + scale_y_continuous(limits = quantile(licitacao_vitorias$valorproposta, c(0.1,0.9))) + theme_bw() +theme(axis.text.x = element_blank())
consulta_m <-consulta %>%  group_by(modalidade) %>%
summarise(media = mean(valorproposta, na.rm = T), mediana = median(valorproposta,na.rm = T), dp = sd(valorproposta,na.rm = T), max(valorproposta,na.rm = T), min(valorproposta,na.rm = T))
view <- ggplot(consulta, aes(x = tipoobjeto, y = valorproposta, colour = tipoobjeto))
view + geom_boxplot() + scale_y_continuous(limits = quantile(licitacao_vitorias$valorproposta, c(0.1,0.9)))
consulta_c <- consulta %>% group_by(tipoobjeto) %>% summarise(mediana = median(valorproposta), cont = n())
view2 <- ggplot(consulta_c, aes(x = tipoobjeto, y= mediana, fill = tipoobjeto))
view2 + geom_col() + theme( plot.title = element_text(hjust = 0.5)) + geom_text(label = consulta_c$mediana , vjust = -0.3) + theme(axis.text.x = element_blank())
view <- ggplot(consulta, aes(x= mesorregiao, y= valorproposta, colour = mesorregiao))
view + geom_boxplot()
view + geom_boxplot() + scale_y_continuous(limits = quantile(licitacao_vitorias$valorproposta, c(0.1,0.9)))
view <- ggplot(consulta, aes(x = as.Date(datahomologacao, format("%Y")), y = valorproposta), alpha = 0.5)
view + geom_col(aes(colour = mesorregiao, fill = mesorregiao))
view + geom_col(aes(colour = modalidade, fill = modalidade))
view + geom_col(aes(colour = tipoobjeto, fill = tipoobjeto))
rm(estat, lic_meso, lic_mun, consulta, consulta_c, consulta_m)
View(licitacao_info)
View(licitacao_num)
x <-licitacao_info %>% group_by(tipoobjeto) %>% summarise(n())
View(x)
knitr::opts_chunk$set(echo = TRUE)
l_alien <- l_reg %>% filter(id_obj = 1)
l_reg <- licitacao_num %>%
select( -id_meso, -id_mic, -cpf.cnpj) %>%
filter(situacaodaproposta == 1 & !is.na(valorcontratado) & valorcontratado > 200)
colnames(l_reg)[which(names(l_reg) == "% vitoria")] <- "vitoria"
#Agrupamento por valor contratado e proposta
l_reg <- l_reg %>%
select(-situacaodaproposta, -participacao, - vitoria, -tipo_pessoa) %>%
group_by_at(vars(idlicitacao:id_mod,valorhomologado:id_mun )) %>%
summarise(soma_proposta = sum(valorproposta), soma_contrato = sum(valorcontratado)) %>%
ungroup()
l_alien <- l_reg %>% filter(id_obj = 1)
l_alien <- l_reg %>% filter(id_obj == 1)
rm(x)
rm(estat, lic_meso, lic_mun, consulta, consulta_c, consulta_m, view, view2)
x <-licitacao_info %>% group_by(modalidade) %>% summarise(n())
View(x)
str(licitacao_num$id_mod)
summary(licitacao_num$id_mod)
l_compras <- l_reg %>% filter(id_obj == 2)
l_adesao <- l_reg %>% filter(id_mod == 1)
l_concorrencia <- l_reg %>% filter(id_mod == 3)
l_dispensa <- l_reg %>% filter(id_mod == 6)
l_leilao <- l_reg %>% filter(id_mod == 9)
l_p_pres <- l_reg %>% filter(id_mod == 11)
rm(x)
corr <- cor(licitacao_vitorias, use = 'complete.obs')
View(licitacao_vitorias)
corr <- cor(licitacao_num, use = 'complete.obs', method = 'pearson')
View(licitacao_num)
str(licitacao_num)
corr <- licitacao_num %>% select(-cpf.cnpj)
corr <- cor(corr, use = 'complete.obs', method = 'pearson')
cor(corr, use = 'complete.obs', method = 'pearson')
corr <- licitacao_num %>% select(-cpf.cnpj)
cor(corr, use = 'complete.obs', method = 'pearson')
corr <- licitacao_num %>% select(-cpf.cnpj, - id_meso, -id_mic)
cor(corr, use = 'complete.obs', method = 'pearson')
pearson <- licitacao_num %>% select(-cpf.cnpj, - id_meso, -id_mic, tipo_pessoa, governoestadual, id_mod, id_obj)
cor(pearson, use = 'complete.obs', method = 'pearson')
pearson <- licitacao_num %>% select(-cpf.cnpj, - id_meso, -id_mic, -tipo_pessoa, -governoestadual, -id_mod, -id_obj)
cor(pearson, use = 'complete.obs', method = 'pearson')
pearson <- licitacao_num %>% select(-cpf.cnpj, - id_meso, -id_mic, -id_mun, -id_jur,-situacaodaproposta, -tipo_pessoa, -governoestadual,-idlicitacao, -id_mod, -id_obj)
cor(pearson, use = 'complete.obs', method = 'pearson')
cor(licitacao_num, use = 'complete.obs', method = 'spearman')
spearman <- licitacao_num %>% select(-cpf.cnpj)
cor(spearman, use = 'complete.obs', method = 'spearman')
knitr::opts_chunk$set(echo = TRUE)
library("stringr")
library("tidyverse")
library("data.table")
library("ggplot2")
library("stringr")
library("tidyverse")
library("data.table")
library("ggplot2")
setwd('C:/Users/LuizH/Documents/TCC/Web Scrapping')
cups <- read.csv2('cups.csv', sep = ',')
cups <- read.csv2('cup.csv', sep = ',')
View(cups)
str(cups)
cups$name <- as.character(cups$name)
str(cups)
summary(cups)
error <- cups %>% filter(role == 'fifa.fieldPos_0')
View(error)
cups <- cups %>% mutate(role = ifelse(role == 'fifa.fieldPos_0', 'FW', role))
View(cups)
library("stringr")
library("tidyverse")
library("data.table")
library("ggplot2")
setwd('C:/Users/LuizH/Documents/TCC/Web Scrapping')
cups <- read.csv2('cup.csv', sep = ',')
cups$name <- as.character(cups$name)
str(cups)
summary(cups)
#cups <- cups %>% mutate(role = ifelse(role == 'fifa.fieldPos_0', 'FW', role))
#error <- cups %>% filter(role == 'fifa.fieldPos_0') #Position not set, replacing for 'FW'
cups$position <- as.character(cups$position)
library("stringr")
library("tidyverse")
library("data.table")
library("ggplot2")
setwd('C:/Users/LuizH/Documents/TCC/Web Scrapping')
cups <- read.csv2('cup.csv', sep = ',')
cups$name <- as.character(cups$name)
cups$position <- as.character(cups$position)
View(cups)
library("stringr")
library("tidyverse")
library("data.table")
library("ggplot2")
setwd('C:/Users/LuizH/Documents/TCC/Web Scrapping')
cups <- read.csv2('cup.csv', sep = ',')
cups$name <- as.character(cups$name)
cups$role <- as.character(cups$role)
str(cups)
summary(cups)
cups <- cups %>% mutate(role = ifelse(role == 'fifa.fieldPos_0', 'FW', role))
#error <- cups %>% filter(role == 'fifa.fieldPos_0') #Position not set, replacing for 'FW'
cups$role <- factor(cups$role)
library("stringr")
library("tidyverse")
library("data.table")
library("ggplot2")
setwd('C:/Users/LuizH/Documents/TCC/Web Scrapping')
cups <- read.csv2('cup.csv', sep = ',')
cups$name <- as.character(cups$name)
cups$role <- as.character(cups$role)
#error <- cups %>% filter(role == 'fifa.fieldPos_0') #Position not set, replacing for 'FW'
cups <- cups %>% mutate(role = ifelse(role == 'fifa.fieldPos_0', 'FW', role))
cups$role <- factor(cups$role)
str(cups)
summary(cups)
library("stringr")
library("tidyverse")
library("data.table")
library("ggplot2")
setwd('C:/Users/LuizH/Documents/TCC/Web Scrapping')
cups <- read.csv2('cup.csv', sep = ',')
cups$role <- as.character(cups$role)
#error <- cups %>% filter(role == 'fifa.fieldPos_0') #Position not set, replacing for 'FW'
cups <- cups %>% mutate(role = ifelse(role == 'fifa.fieldPos_0', 'FW', role))
cups$role <- factor(cups$role)
str(cups)
summary(cups)
cups <- read.csv2('cup.csv', sep = ',')
#Position not set, replacing for 'FW'
#error <- cups %>% filter(role == 'fifa.fieldPos_0')
cups$role <- as.character(cups$role)
cups <- cups %>% mutate(role = ifelse(role == 'fifa.fieldPos_0', 'FW', role))
cups$role <- factor(cups$role)
str(cups)
summary(cups)
players <- cups %>% group_by(name)
rm(erro)
rm(error)
players <- cups %>% group_by(name) %>% summarise_at(c('goals','pens','assist','minutes','matches'))
players <- cups %>% group_by(name) %>% summarise_at(c('goals','pens','assist','minutes','matches'), funs(sum))
View(players)
players <- cups %>%
group_by(name) %>%
summarise_at(c('goals','pens','assist','minutes','matches'), funs(sum)) %>%
arrange(goals,assist)
View(players)
players <- cups %>%
group_by(name) %>%
summarise_at(c('goals','pens','assist','minutes','matches'), funs(sum)) %>%
arrange(desc(goals,assist))
View(players)
players <- cups %>%
group_by(name) %>%
summarise_at(c('goals','pens','assist','minutes','matches'), funs(sum)) %>%
arrange(desc(goals), desc(assist)) %>% ungroup()
View(players)
players <- cups %>%
group_by(name) %>%
summarise_at(c('goals','pens','assist','minutes','matches'), funs(sum)) %>%
summarise(goals_minute = goals/minutes) %>%
summarise(gols_match = goals/matches) %>%
arrange(desc(goals), desc(assist)) %>% ungroup()
players <- cups %>%
group_by(name) %>%
summarise_at(c('goals','pens','assist','minutes','matches'), funs(sum)) %>%
mutate(goals_minute = goals/minutes) %>%
mutate(gols_match = goals/matches) %>%
arrange(desc(goals), desc(assist)) %>% ungroup()
players <- cups %>%
group_by(name) %>%
summarise_at(c('goals','pens','assist','minutes','matches'), funs(sum)) %>%
mutate(gols_match = goals/matches) %>%
arrange(desc(goals), desc(assist)) %>% ungroup()
knitr::opts_chunk$set(echo = TRUE)
library("stringr")
library("tidyverse")
library("data.table")
library("ggplot2")
setwd('C:\\Users\\LuizH\\Documents\\TCC\\Web Scrapping')
cups <- read.csv2('cup-igoals.csv', sep = ',')
#Position not set, replacing for 'FW'
#error <- cups %>% filter(role == 'fifa.fieldPos_0')
cups$role <- as.character(cups$role)
cups <- cups %>% mutate(role = ifelse(role == 'fifa.fieldPos_0', 'FW', role))
cups$role <- factor(cups$role)
str(cups)
summary(cups)
players <- cups %>%
group_by(name,role) %>%
summarise_at(vars(c('goals','pens','assist','minutes','matches', 'rank')), funs(sum, mean)  ) %>%
mutate(goals_match = goals_sum/matches_sum) %>%
mutate(rank_mean = round(rank_mean)) %>%
mutate_if(is.double, round, digits = 2) %>%
arrange(desc(goals_sum), desc(assist_sum)) %>%
select(-rank_mean, rank_mean) %>%
ungroup()
not_fw = players[players$role != 'FW',]
gg <- ggplot(data = players, aes(y = goals_sum, x = matches_sum )) +
geom_point(aes(colour = role, size = minutes_sum), alpha = 0.3) +
geom_smooth(method="loess", se=F) +
theme_bw() +
labs(subtitle = 'All time Goals per Matches',
title = 'FIFA WORLD CUP',
x = 'Matches',
y = 'Goals',
caption = 'Source: FIFA.com',
color = 'Role',
size = 'Minutes Played')
gg2 <- ggplot(data = players, aes(y = goals_sum, x = matches_sum )) +
geom_point(aes(colour = role, size = goals_match), alpha = 0.5) +
geom_smooth(method="loess", se=F) +
theme_bw() +
labs(subtitle = 'All time Goals per Matches',
title = 'FIFA WORLD CUP',
x = 'Matches',
y = 'Goals',
caption = 'Source: FIFA.com',
color = 'Role',
size = 'Goals per Match')
plot(gg2)
out <- players %>% split(players$role)
ggFW <-  ggplot(data = out$FW, aes(y = goals_sum, x = matches_sum )) +
geom_point(aes(colour = goals_match, size = minutes_sum), alpha = 0.3) +
geom_smooth(method="loess", se=F) +
theme_bw() +
labs(subtitle = 'All time Goals vs Matches',
title = 'FIFA WORLD CUP',
x = 'Matches',
y = 'Goals',
caption = 'Source: FIFA.com',
color = 'Goals per Match',
size = 'Minutes Played')
ggMF <-  ggplot(data = out$MF, aes(y = goals_sum, x = matches_sum )) +
geom_point(aes(colour = goals_match, size = minutes_sum), alpha = 0.3) +
geom_smooth(method="loess", se=F) +
theme_bw() +
labs(subtitle = 'All time Goals vs Matches',
title = 'FIFA WORLD CUP',
x = 'Matches',
y = 'Goals',
caption = 'Source: FIFA.com',
color = 'Goals per Match',
size = 'Minutes Played')
ggDF <-  ggplot(data = out$DF, aes(y = goals_sum, x = matches_sum )) +
geom_point(aes(colour = goals_match, size = minutes_sum), alpha = 0.3) +
geom_smooth(method="loess", se=F) +
theme_bw() +
labs(subtitle = 'All time Goals vs Matches',
title = 'FIFA WORLD CUP',
x = 'Matches',
y = 'Goals',
caption = 'Source: FIFA.com',
color = 'Goals per Match',
size = 'Minutes Played')
plot(ggFW)
plot(ggMF)
plot(ggDF)
View(players)
knitr::opts_chunk$set(echo = TRUE)
library("stringr")
library("tidyverse")
library("data.table")
library("ggplot2")
setwd('C:\\Users\\LuizH\\Documents\\TCC\\Web Scrapping')
cups <- read.csv2('cup-igoals.csv', sep = ',')
#Position not set, replacing for 'FW'
#error <- cups %>% filter(role == 'fifa.fieldPos_0')
cups$role <- as.character(cups$role)
cups <- cups %>% mutate(role = ifelse(role == 'fifa.fieldPos_0', 'FW', role))
cups$role <- factor(cups$role)
str(cups)
summary(cups)
players <- cups %>%
group_by(name) %>%
summarise_at(vars(c('goals','pens','assist','minutes','matches', 'rank')), funs(sum, mean)  ) %>%
mutate(goals_match = goals_sum/matches_sum) %>%
mutate(rank_mean = round(rank_mean)) %>%
mutate_if(is.double, round, digits = 2) %>%
arrange(desc(goals_sum), desc(assist_sum)) %>%
select(-rank_mean, rank_mean) %>%
ungroup()
not_fw = players[players$role != 'FW',]
gg <- ggplot(data = players, aes(y = goals_sum, x = matches_sum )) +
geom_point(aes(colour = role, size = minutes_sum), alpha = 0.3) +
geom_smooth(method="loess", se=F) +
theme_bw() +
labs(subtitle = 'All time Goals per Matches',
title = 'FIFA WORLD CUP',
x = 'Matches',
y = 'Goals',
caption = 'Source: FIFA.com',
color = 'Role',
size = 'Minutes Played')
gg2 <- ggplot(data = players, aes(y = goals_sum, x = matches_sum )) +
geom_point(aes(colour = role, size = goals_match), alpha = 0.5) +
geom_smooth(method="loess", se=F) +
theme_bw() +
labs(subtitle = 'All time Goals per Matches',
title = 'FIFA WORLD CUP',
x = 'Matches',
y = 'Goals',
caption = 'Source: FIFA.com',
color = 'Role',
size = 'Goals per Match')
plot(gg2)
View(players)
